const axios = require('axios');
const IO = require('../socket');

async function getStock(req,res){
    const options = {
        method: 'GET',url: 'https://apidojo-yahoo-finance-v1.p.rapidapi.com/market/v2/get-quotes',
        params: {
          region: 'IN',
          symbols: 'TCS.NS, ONGC.NS, BAJAJFINSV.NS, UPL.NS, BAJFINANCE.NS, SBILIFE.NS, BPCL.NS, ITC.NS, HINDALCO.NS, JSWSTEEL.NS,BAJAJ-AUTO.NS, KOTAKBANK.NS, COALINDIA.NS, M&M.NS, TATAMOTORS.NS, INFY.NS, EICHERMOT.NS, TATASTEEL.NS, TECHM.NS, RELIANCE.NS, NESTLEIND.NS, INDUSINDBK.NS, LT.NS, BRITANNIA.NS,BHARTIARTL.NS, ULTRACEMCO.NS, DRREDDY.NS, HCLTECH.NS, TATACONSUM.NS, ADANIENT.NS, HEROMOTOCO.NS, HDFCBANK.NS, WIPRO.NS, NTPC.NS, MARUTI.NS,TITAN.NS,DIVISLAB.NS,ICICIBANK.NS,ADANIPORTS.NS,HDFC.NS,ASIANPAINT.NS,CIPLA.NS,AXISBANK.NS,SBIN.NS,GRASIM.NS,SUNPHARMA.NS,APOLLOHOSP.NS,HINDUNILVR.NS,POWERGRID.NS,HDFCLIFE.NS'
        },headers: {
          'X-RapidAPI-Key': 'c6e48adc6dmsh05900b13b361ae0p17f651jsn7a03c8e8b550',
          'X-RapidAPI-Host': 'apidojo-yahoo-finance-v1.p.rapidapi.com'
        }
      };try {
          const response = await axios.request(options);
          const Data = response.data
          const metaData =[]
/**************************************************    SYMBOL    *************************************************************/

metaData.push({SYMBOL:Data['quoteResponse']['result'][0]['shortName'],LTP: Data['quoteResponse']['result'][0]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][0]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][0]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][0]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][1]['shortName'],LTP: Data['quoteResponse']['result'][1]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][1]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][1]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][1]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][2]['shortName'],LTP: Data['quoteResponse']['result'][2]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][2]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][2]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][2]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][3]['shortName'],LTP: Data['quoteResponse']['result'][3]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][3]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][3]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][3]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][4]['shortName'],LTP: Data['quoteResponse']['result'][4]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][4]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][4]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][4]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][5]['shortName'],LTP: Data['quoteResponse']['result'][5]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][5]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][5]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][5]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][6]['shortName'],LTP: Data['quoteResponse']['result'][6]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][6]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][6]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][6]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][7]['shortName'],LTP: Data['quoteResponse']['result'][7]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][7]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][7]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][7]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][8]['shortName'],LTP: Data['quoteResponse']['result'][8]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][8]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][8]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][8]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][9]['shortName'],LTP: Data['quoteResponse']['result'][9]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][9]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][9]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][9]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][10]['shortName'],LTP: Data['quoteResponse']['result'][10]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][10]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][10]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][10]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][11]['shortName'],LTP: Data['quoteResponse']['result'][11]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][11]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][11]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][11]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][12]['shortName'],LTP: Data['quoteResponse']['result'][12]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][12]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][12]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][12]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][13]['shortName'],LTP: Data['quoteResponse']['result'][13]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][13]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][13]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][13]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][14]['shortName'],LTP: Data['quoteResponse']['result'][14]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][14]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][14]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][14]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][15]['shortName'],LTP: Data['quoteResponse']['result'][15]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][15]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][15]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][15]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][16]['shortName'],LTP: Data['quoteResponse']['result'][16]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][16]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][16]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][16]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][17]['shortName'],LTP: Data['quoteResponse']['result'][17]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][17]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][17]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][17]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][18]['shortName'],LTP: Data['quoteResponse']['result'][18]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][18]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][18]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][18]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][19]['shortName'],LTP: Data['quoteResponse']['result'][19]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][19]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][19]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][19]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][20]['shortName'],LTP: Data['quoteResponse']['result'][20]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][20]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][20]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][20]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][21]['shortName'],LTP: Data['quoteResponse']['result'][21]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][21]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][21]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][21]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][22]['shortName'],LTP: Data['quoteResponse']['result'][22]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][22]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][22]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][22]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][23]['shortName'],LTP: Data['quoteResponse']['result'][23]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][23]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][23]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][23]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][24]['shortName'],LTP: Data['quoteResponse']['result'][24]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][24]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][24]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][24]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][25]['shortName'],LTP: Data['quoteResponse']['result'][25]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][25]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][25]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][25]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][26]['shortName'],LTP: Data['quoteResponse']['result'][26]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][26]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][26]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][26]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][27]['shortName'],LTP: Data['quoteResponse']['result'][27]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][27]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][27]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][27]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][28]['shortName'],LTP: Data['quoteResponse']['result'][28]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][28]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][28]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][28]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][29]['shortName'],LTP: Data['quoteResponse']['result'][29]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][29]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][29]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][29]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][30]['shortName'],LTP: Data['quoteResponse']['result'][30]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][30]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][30]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][30]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][31]['shortName'],LTP: Data['quoteResponse']['result'][31]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][31]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][31]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][31]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][32]['shortName'],LTP: Data['quoteResponse']['result'][32]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][32]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][32]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][32]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][33]['shortName'],LTP: Data['quoteResponse']['result'][33]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][33]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][33]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][33]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][34]['shortName'],LTP: Data['quoteResponse']['result'][34]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][34]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][34]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][34]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][35]['shortName'],LTP: Data['quoteResponse']['result'][35]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][35]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][35]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][35]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][36]['shortName'],LTP: Data['quoteResponse']['result'][36]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][36]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][36]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][36]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][37]['shortName'],LTP: Data['quoteResponse']['result'][37]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][37]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][37]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][37]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][38]['shortName'],LTP: Data['quoteResponse']['result'][38]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][38]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][38]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][38]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][39]['shortName'],LTP: Data['quoteResponse']['result'][39]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][39]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][39]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][39]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][40]['shortName'],LTP: Data['quoteResponse']['result'][40]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][40]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][40]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][40]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][41]['shortName'],LTP: Data['quoteResponse']['result'][41]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][41]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][41]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][41]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][42]['shortName'],LTP: Data['quoteResponse']['result'][42]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][42]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][42]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][42]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][43]['shortName'],LTP: Data['quoteResponse']['result'][43]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][43]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][43]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][43]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][44]['shortName'],LTP: Data['quoteResponse']['result'][44]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][44]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][44]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][44]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][45]['shortName'],LTP: Data['quoteResponse']['result'][45]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][45]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][45]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][45]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][46]['shortName'],LTP: Data['quoteResponse']['result'][46]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][46]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][46]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][46]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][47]['shortName'],LTP: Data['quoteResponse']['result'][47]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][47]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][47]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][47]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][48]['shortName'],LTP: Data['quoteResponse']['result'][48]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][48]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][48]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][48]['regularMarketChange'].toString().split('.')[0])})
metaData.push({SYMBOL:Data['quoteResponse']['result'][49]['shortName'],LTP: Data['quoteResponse']['result'][49]['regularMarketPrice'],CHNG: Data['quoteResponse']['result'][49]['regularMarketChange'],PcCHNG: Data['quoteResponse']['result'][49]['regularMarketChangePercent'],sign: Math.sign(Data['quoteResponse']['result'][49]['regularMarketChange'].toString().split('.')[0])})

    IO.getIO().emit('get:Stocks',metaData);
    res.status(200).json(metaData)
      }

/*******************************************************************************************************************************/
        catch (error) {
            console.error(error);
            res.status(500).json({message:"something went wrong"})
      }
    }
    
module.exports={
    getStock
}